#!/bin/bash

nsname=$1
sampsfile=$2
sampscols=$3
nsamps=$4
conflvl=$5
outdir=$6

echo $nsname > "$outdir/${nsname}_params.in"
echo $sampsfile >> "$outdir/${nsname}_params.in"
echo $sampscols >> "$outdir/${nsname}_params.in"
echo $nsamps >> "$outdir/${nsname}_params.in"
echo $conflvl >> "$outdir/${nsname}_params.in"
echo $outdir >> "$outdir/${nsname}_params.in"

inferprops $nsname -v -p I12,Omega12 -D genbetaprime,samples,samples,samples,samples -P 1.+0.934305+2.85628+191.509,$sampsfile,$sampsfile,$sampsfile,$sampsfile -s $sampscols -n $nsamps -o $outdir/

inferprops ${nsname}_prior -v -p I12,Omega12 -D genbetaprime,uniform_mcq,uniform_mcq,uniform,uniform -P 1.+0.934305+2.85628+191.509,1.485+1.490+0.3+1.0+1,1.485+1.490+0.3+1.0+2,-0.8+0.8,-0.8+0.8 -n $nsamps -o $outdir/

plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x I1 -t I1 -b 100 -d $outdir/ -o $outdir/ -f rotpost_ -A "\$I_1\$ [10\$^{45}\$ g cm\$^2\$]","" -l 0.5,3.5,0.,1.8
plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x Omega1 -t Omega1 -b 100 -d $outdir/ -o $outdir/ -f rotpost_ -A "\$\Omega_1\$ [rad/s]","" -l -6000.,12000.,0.,0.0005
plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x I2 -t I2 -b 100 -d $outdir/ -o $outdir/ -f rotpost_ -A "\$I_2\$ [10\$^{45}\$ g cm\$^2\$]","" -l 0.5,3.5,0.,1.8
plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x Omega2 -t Omega2 -b 100 -d $outdir/ -o $outdir/ -f rotpost_ -A "\$\Omega_2\$ [rad/s]","" -l -6000.,12000.,0.,0.0005

plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x M1 -t m1 -b 100 -d $outdir/ -o $outdir/ -f rotprior_ -A "\$m_1\$ [\$M_{\odot}\$]","" -l 1.,3.,0.,4.
plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x chi1 -t chi1 -b 100 -d $outdir/ -o $outdir/ -f rotprior_ -A "\$\chi_1\$","" -l -0.4,0.6,0.,8.
plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x M2 -t m2 -b 100 -d $outdir/ -o $outdir/ -f rotprior_ -A "\$m_2\$ [\$M_{\odot}\$]","" -l 1.,3.,0.,4.
plothist "${nsname}_props.csv,${nsname}_prior_props.csv" -x chi2 -t chi2 -b 100 -d $outdir/ -o $outdir/ -f rotprior_ -A "\$\chi_2\$","" -l -0.4,0.6,0.,8.

calcintervals -v "${nsname}_props.csv" -p M1,M2,chi1,chi2,I1,I2,Omega1,Omega2 -L $conflvl -d $outdir/ -o $outdir/

plotcorner "${nsname}_prior_props.csv,${nsname}_props.csv" -x f1,f2 -d $outdir/ -o $outdir/ -f spinfreqs -C 0.5,0.9 -l 0.,1000.,0.,1000. -A '$f_1$ [Hz]','$f_2$ [Hz]' -q 0.9 -T 716.,59.
